# 장편 소설 창작 AI 시스템 사용 가이드

## 🎯 해결하는 문제

이 시스템은 다음 문제들을 해결합니다:

1. **3만자/20화 벽**: 체크포인트 시스템으로 장기 기억 유지
2. **맥락 유지 실패**: 계층적 요약과 컨텍스트 주입으로 초반 설정 유지
3. **논리적 구조력 부재**: 구조화된 프롬프트로 전체 플롿 유지
4. **편집 비용 역전**: 자동 검증과 일관성 체크로 편집 비용 감소

## 🚀 빠른 시작

### 1. 기본 사용

```bash
python scripts/long_form_novel_generator.py
```

### 2. 소설 초기화

스크립트 실행 후:
1. 소설 ID 입력 (예: "my_novel_001")
2. 제목, 장르 입력
3. 세계관 설정 입력
4. 등장인물 정보 입력
5. 플롿 구조 입력

### 3. 챕터 생성

초기화 후:
1. 챕터 번호 입력
2. 챕터 목표/주요 사건 입력
3. 목표 분량 입력 (기본 5000자)
4. 자동 생성 및 저장

## 📁 파일 구조

```
novels/
└── {novel_id}/
    ├── checkpoints/
    │   └── {novel_id}_checkpoint.json  # 체크포인트 데이터
    └── chapters/
        ├── chapter_001.md
        ├── chapter_002.md
        └── ...
```

## 🔧 주요 기능

### 1. 체크포인트 시스템

**자동 저장:**
- 캐릭터 상태
- 세계관 설정 변경사항
- 복선/떡밥 목록
- 챕터 요약
- 문체 샘플

**사용:**
- 각 챕터 생성 전 자동 로드
- 일관성 유지에 활용

### 2. 계층적 요약 시스템

**3단계 요약:**
1. 챕터 요약 (1000자)
2. 아크 요약 (500자)
3. 전체 요약 (200자)

**효과:**
- 긴 컨텍스트 대신 요약 사용
- 메모리 효율성 극대화
- 핵심 정보만 유지

### 3. 구조화된 프롬프트

**계층적 구조:**
- Level 1: 전체 플롿 구조
- Level 2: 챕터 구조
- Level 3: 씬 생성

**효과:**
- 전체 구조 유지
- 부분과 전체의 일관성

## 💡 사용 팁

### 효과적인 사용법

1. **초기 설정을 상세히**
   - 세계관 규칙 명확히
   - 캐릭터 성격 구체적으로
   - 플롿 구조 미리 작성

2. **챕터 목표를 구체적으로**
   - "주인공이 적을 만남" ❌
   - "주인공이 숲에서 괴물과 조우하고, 도망치면서 새로운 능력을 각성함" ✅

3. **정기적으로 체크포인트 확인**
   - 복선이 누락되지 않았는지
   - 캐릭터 상태가 일관적인지
   - 설정 오류가 없는지

4. **문체 샘플 활용**
   - 초반 3개 챕터의 문체가 중요
   - 이후 챕터는 이 문체를 참고

### 주의사항

⚠️ **여전히 인간 편집 필요**
- AI는 도구일 뿐, 최종 완성은 인간이 해야 함
- 플롿 구조는 미리 계획하는 것이 좋음
- 문학적 완성도는 인간이 다듬어야 함

⚠️ **API 비용 고려**
- 챕터마다 API 호출 발생
- 긴 프롬프트는 토큰 비용 증가
- 로컬 모델 사용 권장 (장기적으로)

## 🔮 로컬 모델 연동 (향후)

현재는 웹 API(OpenAI, Claude)를 사용하지만, 로컬 모델 연동도 가능합니다:

### 추천 로컬 모델

1. **Llama 3.1 70B** (Qwen2.5 기반)
   - 긴 컨텍스트 (128K)
   - 한국어 성능 우수
   - RTX 4090 24GB 이상 필요

2. **Qwen2.5 72B**
   - 한국어 특화
   - 컨텍스트 32K+
   - 상대적으로 가벼움

3. **Yi-34B**
   - 200K 컨텍스트
   - 한국어 파인튜닝 버전

### 로컬 모델 연동 방법

1. Ollama 또는 LM Studio로 모델 실행
2. `models/providers/base.py`에 로컬 프로바이더 추가
3. API 엔드포인트를 로컬로 변경

## 📊 예상 효과

### Before (웹 모델만 사용)
- 3만자 넘으면 문체 깨짐
- 20화 넘으면 설정 오류
- 후반부 70% 수정 필요

### After (이 시스템 사용)
- 체크포인트로 장기 기억 유지
- 요약 시스템으로 맥락 유지
- 구조화된 프롬프트로 플롿 유지
- 후반부 30% 수정으로 감소 가능

## 🛠️ 고급 사용법

### 커스텀 체크포인트 필드 추가

`scripts/long_form_novel_generator.py`의 `NovelCheckpoint` 클래스를 수정하여 추가 필드 저장 가능

### 벡터 DB 연동 (RAG)

향후 ChromaDB나 FAISS를 연동하여 더 정교한 컨텍스트 검색 가능

### 자동 편집 기능

생성된 텍스트에서 설정 오류를 자동으로 찾아 수정하는 기능 추가 가능

## 📚 참고 문서

- [장편 소설 솔루션 가이드](docs/long_form_writing_solution.md)
- [프롬프트 작성 가이드](docs/prompt_guide.md)
- [모델 설정 가이드](docs/model_config.md)

## ❓ FAQ

**Q: 정말 3만자 벽을 넘을 수 있나요?**
A: 체크포인트와 요약 시스템으로 가능합니다. 다만 완벽하지는 않고 여전히 일부 수정이 필요합니다.

**Q: 로컬 모델 없이도 사용 가능한가요?**
A: 네, 웹 API(OpenAI, Claude)로도 사용 가능합니다. 다만 비용이 발생합니다.

**Q: 복선을 자동으로 회수해주나요?**
A: 복선 목록을 추적하고 프롬프트에 포함시키지만, 실제 회수는 AI가 수행합니다. 완벽하지 않을 수 있어 인간 검토가 필요합니다.

**Q: 문체가 여전히 깨지면?**
A: 문체 샘플을 더 많이 포함하거나, 초반 챕터를 재검토하세요. 필요시 수동으로 수정해야 합니다.

